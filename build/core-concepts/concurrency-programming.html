<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Concurrency Programming | Today I Learned</title>
    <meta name="generator" content="VuePress 1.8.1">
    <link rel="icon" href="/TIL/logo.png">
    <meta name="description" content="Sunggwon's Personal Wiki (Today I Learned)">
    
    <link rel="preload" href="/TIL/assets/css/0.styles.c8870fcb.css" as="style"><link rel="preload" href="/TIL/assets/js/app.4d106f67.js" as="script"><link rel="preload" href="/TIL/assets/js/2.dd2ad777.js" as="script"><link rel="preload" href="/TIL/assets/js/11.ade46d73.js" as="script"><link rel="prefetch" href="/TIL/assets/js/10.74153474.js"><link rel="prefetch" href="/TIL/assets/js/12.4f0c88e7.js"><link rel="prefetch" href="/TIL/assets/js/13.27cfc071.js"><link rel="prefetch" href="/TIL/assets/js/14.6ce8652e.js"><link rel="prefetch" href="/TIL/assets/js/15.798efad0.js"><link rel="prefetch" href="/TIL/assets/js/16.bbae8aea.js"><link rel="prefetch" href="/TIL/assets/js/17.1c7d4b38.js"><link rel="prefetch" href="/TIL/assets/js/18.497ccb85.js"><link rel="prefetch" href="/TIL/assets/js/19.5cb5d530.js"><link rel="prefetch" href="/TIL/assets/js/20.1a267076.js"><link rel="prefetch" href="/TIL/assets/js/21.ac861373.js"><link rel="prefetch" href="/TIL/assets/js/22.f08a792a.js"><link rel="prefetch" href="/TIL/assets/js/23.61675d87.js"><link rel="prefetch" href="/TIL/assets/js/24.39b9fe62.js"><link rel="prefetch" href="/TIL/assets/js/25.fa69f945.js"><link rel="prefetch" href="/TIL/assets/js/26.bd5e6a05.js"><link rel="prefetch" href="/TIL/assets/js/27.4735493c.js"><link rel="prefetch" href="/TIL/assets/js/28.32d972bd.js"><link rel="prefetch" href="/TIL/assets/js/29.f6d0ce75.js"><link rel="prefetch" href="/TIL/assets/js/3.c899a5fb.js"><link rel="prefetch" href="/TIL/assets/js/30.c32f4448.js"><link rel="prefetch" href="/TIL/assets/js/31.befff923.js"><link rel="prefetch" href="/TIL/assets/js/32.f02ab26d.js"><link rel="prefetch" href="/TIL/assets/js/33.bd31deff.js"><link rel="prefetch" href="/TIL/assets/js/34.5bc59b29.js"><link rel="prefetch" href="/TIL/assets/js/35.327296d8.js"><link rel="prefetch" href="/TIL/assets/js/36.00210420.js"><link rel="prefetch" href="/TIL/assets/js/37.038ab779.js"><link rel="prefetch" href="/TIL/assets/js/38.5c9e0b5b.js"><link rel="prefetch" href="/TIL/assets/js/39.33362775.js"><link rel="prefetch" href="/TIL/assets/js/4.8d4f8373.js"><link rel="prefetch" href="/TIL/assets/js/40.f0931e73.js"><link rel="prefetch" href="/TIL/assets/js/41.a78e720f.js"><link rel="prefetch" href="/TIL/assets/js/42.7a80e8af.js"><link rel="prefetch" href="/TIL/assets/js/43.a5359b2e.js"><link rel="prefetch" href="/TIL/assets/js/44.73605116.js"><link rel="prefetch" href="/TIL/assets/js/45.6b785613.js"><link rel="prefetch" href="/TIL/assets/js/46.4e5bf96a.js"><link rel="prefetch" href="/TIL/assets/js/47.2e50dc10.js"><link rel="prefetch" href="/TIL/assets/js/48.a3a03e29.js"><link rel="prefetch" href="/TIL/assets/js/5.1f0a6209.js"><link rel="prefetch" href="/TIL/assets/js/6.d26ae6f4.js"><link rel="prefetch" href="/TIL/assets/js/7.2487e5f8.js"><link rel="prefetch" href="/TIL/assets/js/8.96704580.js"><link rel="prefetch" href="/TIL/assets/js/9.51432a92.js">
    <link rel="stylesheet" href="/TIL/assets/css/0.styles.c8870fcb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/TIL/" class="home-link router-link-active"><!----> <span class="site-name">Today I Learned</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/cielgrisdemoscou/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://sunggweon.dev" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/cielgrisdemoscou/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://sunggweon.dev" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Swift / iOS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Views and View Controllers</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Graphics &amp; Animation APIs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Core Concepts</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/TIL/core-concepts/concurrency-programming.html" aria-current="page" class="active sidebar-link">Concurrency Programming</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TIL/core-concepts/concurrency-programming.html#grand-central-dispatch" class="sidebar-link">Grand Central Dispatch</a></li><li class="sidebar-sub-header"><a href="/TIL/core-concepts/concurrency-programming.html#dispatch-queues" class="sidebar-link">Dispatch Queues</a></li><li class="sidebar-sub-header"><a href="/TIL/core-concepts/concurrency-programming.html#operation-queues" class="sidebar-link">Operation Queues</a></li><li class="sidebar-sub-header"><a href="/TIL/core-concepts/concurrency-programming.html#asynchronous-design-techniques" class="sidebar-link">Asynchronous Design Techniques</a></li><li class="sidebar-sub-header"><a href="/TIL/core-concepts/concurrency-programming.html#tips-for-improving-efficiency" class="sidebar-link">Tips for Improving Efficiency</a></li><li class="sidebar-sub-header"><a href="/TIL/core-concepts/concurrency-programming.html#when-to-use-threads" class="sidebar-link">When to Use Threads</a></li><li class="sidebar-sub-header"><a href="/TIL/core-concepts/concurrency-programming.html#references" class="sidebar-link">References</a></li></ul></li><li><a href="/TIL/core-concepts/value-semantics.html" class="sidebar-link">Value Semantics</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Architecture Patterns</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Networking</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Map &amp; Location APIs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>RxSwift</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>UI &amp; UX</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CoreML &amp; ARKit</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Unit Test</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Data</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Université Paris 8</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Useful Articles</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="concurrency-programming"><a href="#concurrency-programming" class="header-anchor">#</a> Concurrency Programming</h1> <p>Concurrency is the notion of multiple things happening at the same time. With the proliferation of multicore CPUs and the realization that the number of cores in each processor will only increase, software developers need new ways to take advantage of them. Although operating systems like OS X and iOS are capable of running multiple programs in parallel, most of those programs run in the background and perform tasks that require little continuous processor time. It is the current foreground application that both captures the user’s attention and keeps the computer busy. If an application has a lot of work to do but keeps only a fraction of the available cores occupied, those extra processing resources are wasted.</p> <h2 id="grand-central-dispatch"><a href="#grand-central-dispatch" class="header-anchor">#</a> Grand Central Dispatch</h2> <p>One of the technologies for starting tasks asynchronously is <code>Grand Central Dispatch (GCD)</code>. This technology takes the thread management code you would normally write in your own applications and moves that code down to the system level. All you have to do is define the tasks you want to execute and add them to an appropriate <code>dispatch queue</code>. GCD takes care of creating the needed threads and of scheduling your tasks to run on those threads. Because the thread management is now part of the system, GCD provides a holistic approach to task management and execution, providing better efficiency than traditional threads.</p> <h2 id="dispatch-queues"><a href="#dispatch-queues" class="header-anchor">#</a> Dispatch Queues</h2> <p>Dispatch queues are a <code>C-based mechanism</code> for executing custom tasks. A dispatch queue executes tasks either serially or concurrently but always in a first-in, first-out order. (In other words, a dispatch queue always dequeues and starts tasks in the same order in which they were added to the queue.) A serial dispatch queue runs only one task at a time, waiting until that task is complete before dequeuing and starting a new one. By contrast, a concurrent dispatch queue starts as many tasks as it can without waiting for already started tasks to finish.</p> <p>Dispatch queues have other benefits:</p> <ul><li>They provide a straightforward and simple programming interface.</li> <li>They offer automatic and holistic thread pool management.</li> <li>They provide the speed of tuned assembly.</li> <li>They are much more memory efficient (because thread stacks do not linger in application memory).</li> <li>They do not trap to the kernel under load.</li> <li>The asynchronous dispatching of tasks to a dispatch queue cannot deadlock the queue.</li> <li>They scale gracefully under contention.</li> <li>Serial dispatch queues offer a more efficient alternative to locks and other synchronization primitives.</li></ul> <p>Dispatch queues are part of <strong>the Grand Central Dispatch technology</strong> and are part of the C runtime.</p> <h2 id="operation-queues"><a href="#operation-queues" class="header-anchor">#</a> Operation Queues</h2> <p>An operation queue is the <code>Cocoa equivalent</code> of a concurrent dispatch queue and is implemented by the <code>NSOperationQueue</code> class. Whereas dispatch queues always execute tasks in first-in, first-out order, <strong>operation queues take other factors into account when determining the execution order of tasks. Primary among these factors is whether a given task depends on the completion of other tasks. You configure dependencies when defining your tasks and can use them to create complex execution-order graphs for your tasks.</strong></p> <p>The tasks you submit to an operation queue must be instances of the <code>NSOperation</code> class. An operation object is an Objective-C object that encapsulates the work you want to perform and any data needed to perform it. Because the NSOperation class is essentially an abstract base class, you typically define custom subclasses to perform your tasks. However, the Foundation framework does include some concrete subclasses that you can create and use as is to perform tasks.</p> <p>Operation objects generate <code>key-value observing (KVO)</code> notifications, which can be a useful way of monitoring the progress of your task. <strong>Although operation queues always execute operations concurrently, you can use dependencies to ensure they are executed serially when needed.</strong></p> <h2 id="asynchronous-design-techniques"><a href="#asynchronous-design-techniques" class="header-anchor">#</a> Asynchronous Design Techniques</h2> <p><strong>Before you even consider redesigning your code to support concurrency, you should ask yourself whether doing so is necessary.</strong> Concurrency can improve the responsiveness of your code by ensuring that your main thread is free to respond to user events. It can even improve the efficiency of your code by leveraging more cores to do more work in the same amount of time. However, it also adds overhead and increases the overall complexity of your code, making it harder to write and debug your code.</p> <p>Because it adds complexity, concurrency is not a feature that you can graft onto an application at the end of your product cycle. Doing it right requires careful consideration of the tasks your application performs and the data structures used to perform those tasks. Done incorrectly, you might find your code runs slower than before and is less responsive to the user. Therefore, it is worthwhile to take some time at the beginning of your design cycle to set some goals and to think about the approach you need to take.</p> <h2 id="tips-for-improving-efficiency"><a href="#tips-for-improving-efficiency" class="header-anchor">#</a> Tips for Improving Efficiency</h2> <p>In addition to simply factoring your code into smaller tasks and adding them to a queue, there are other ways to improve the overall efficiency of your code using queues:</p> <ul><li><strong>Consider computing values directly within your task if memory usage is a factor.</strong> If your application is already memory bound, computing values directly now may be faster than loading cached values from main memory. Computing values directly uses the registers and caches of the given processor core, which are much faster than main memory. Of course, you should only do this if testing indicates this is a performance win.</li> <li><strong>Identify serial tasks early and do what you can to make them more concurrent.</strong> If a task must be executed serially because it relies on some shared resource, consider changing your architecture to remove that shared resource. You might consider making copies of the resource for each client that needs one or eliminate the resource altogether.</li> <li><strong>Avoid using locks.</strong> The support provided by dispatch queues and operation queues makes locks unnecessary in most situations. Instead of using locks to protect some shared resource, designate a serial queue (or use operation object dependencies) to execute tasks in the correct order.</li> <li><strong>Rely on the system frameworks whenever possible.</strong> The best way to achieve concurrency is to take advantage of the built-in concurrency provided by the system frameworks. Many frameworks use threads and other technologies internally to implement concurrent behaviors. When defining your tasks, look to see if an existing framework defines a function or method that does exactly what you want and does so concurrently. Using that API may save you effort and is more likely to give you the maximum concurrency possible.</li></ul> <h2 id="when-to-use-threads"><a href="#when-to-use-threads" class="header-anchor">#</a> When to Use Threads</h2> <p>Although <code>operation queues</code> and <code>dispatch queues</code> are the preferred way to perform tasks concurrently, they are not a panacea. Depending on your application, there may still be times when you need to create custom threads. If you do create custom threads, you should strive to create as few threads as possible yourself and you should use those threads only for specific tasks that cannot be implemented any other way.</p> <p>Threads are still a good way to implement code that must run in real time. <code>Dispatch queues</code> make every attempt to run their tasks as fast as possible but they do not address real time constraints. If you need more predictable behavior from code running in the background, threads may still offer a better alternative.</p> <p>As with any threaded programming, you should always use threads judiciously and only when absolutely necessary.</p> <h2 id="references"><a href="#references" class="header-anchor">#</a> References</h2> <p>More information on Markdown can be found at the following links:</p> <ul><li><a href="https://developer.apple.com/videos/play/wwdc2016/720/" target="_blank" rel="noopener noreferrer">Apple Developer - Concurrent Programming With GCD in Swift 3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40008091-CH1-SW1" target="_blank" rel="noopener noreferrer">Apple Developer - Concurrency Programming Guide<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.freecodecamp.org/news/ios-concurrency/" target="_blank" rel="noopener noreferrer">FreeCodeCamp - How to Build a Multi-Threaded iOS App<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.swiftbysundell.com/articles/task-based-concurrency-in-swift/" target="_blank" rel="noopener noreferrer">SwiftbySundell - Task-based concurrency in Swift<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/TIL/graphics-animation/lottie.html" class="prev">
        How to add Lottie Animations
      </a></span> <span class="next"><a href="/TIL/core-concepts/value-semantics.html">
        Value Semantics
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/TIL/assets/js/app.4d106f67.js" defer></script><script src="/TIL/assets/js/2.dd2ad777.js" defer></script><script src="/TIL/assets/js/11.ade46d73.js" defer></script>
  </body>
</html>
